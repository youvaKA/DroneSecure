<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DroneSecure - Gestion D√©centralis√©e de l'Espace A√©rien</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <h1>üõ∏ DroneSecure</h1>
                    <p class="tagline">Syst√®me de Gestion D√©centralis√©e de l'Espace A√©rien</p>
                </div>
                <div class="wallet-section">
                    <button id="connectWallet" class="btn btn-primary">Connecter Wallet</button>
                    <div id="walletInfo" class="wallet-info hidden">
                        <span id="walletAddress"></span>
                        <span id="userMissionCount" class="badge">0 missions</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Alert Messages -->
        <div id="alertContainer" class="alert-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Connection Required Message -->
            <div id="connectMessage" class="connect-message">
                <h2>üîê Connexion Requise</h2>
                <p>Connectez votre wallet MetaMask pour acc√©der √† DroneSecure</p>
                <button class="btn btn-primary btn-large" onclick="connectWallet()">Connecter MetaMask</button>
            </div>

            <!-- App Content (Hidden until connected) -->
            <div id="appContent" class="app-content hidden">
                <!-- Navigation Tabs -->
                <nav class="tabs">
                    <button class="tab-button active" data-tab="dashboard">üìä Tableau de Bord</button>
                    <button class="tab-button" data-tab="create">‚ûï Cr√©er Mission</button>
                    <button class="tab-button" data-tab="missions">üóÇÔ∏è Mes Missions</button>
                    <button class="tab-button" data-tab="swap">üîÑ √âchanger Ressources</button>
                    <button class="tab-button" data-tab="transfer">üì§ Transf√©rer</button>
                </nav>

                <!-- Tab Contents -->
                <div class="tab-content">
                    <!-- Dashboard Tab -->
                    <div id="dashboard" class="tab-pane active">
                        <h2>Tableau de Bord</h2>
                        
                        <div class="dashboard-grid">
                            <div class="stat-card">
                                <div class="stat-icon">üìã</div>
                                <div class="stat-info">
                                    <div class="stat-value" id="dashMissionCount">0</div>
                                    <div class="stat-label">Missions Actives</div>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">‚è±Ô∏è</div>
                                <div class="stat-info">
                                    <div class="stat-value" id="dashCooldown">Pr√™t</div>
                                    <div class="stat-label">Cooldown</div>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">üéØ</div>
                                <div class="stat-info">
                                    <div class="stat-value" id="dashCanCreate">Oui</div>
                                    <div class="stat-label">Peut Cr√©er</div>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">üè•</div>
                                <div class="stat-info">
                                    <div class="stat-value" id="dashUrgentCount">0</div>
                                    <div class="stat-label">Urgences M√©dicales</div>
                                </div>
                            </div>
                        </div>

                        <div class="info-section">
                            <h3>üîó Informations du Contrat</h3>
                            <div class="contract-info">
                                <div class="info-row">
                                    <span class="info-label">Adresse du Contrat:</span>
                                    <span class="info-value" id="contractAddress">-</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">R√©seau:</span>
                                    <span class="info-value" id="networkName">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="rules-section">
                            <h3>üìú R√®gles de Gestion</h3>
                            <ul class="rules-list">
                                <li>‚úÖ Maximum 4 missions actives par utilisateur</li>
                                <li>‚è±Ô∏è Cooldown de 5 minutes entre deux cr√©ations</li>
                                <li>üîí Lock de 10 minutes apr√®s cr√©ation (transfert bloqu√©)</li>
                                <li>üîÑ √âchange possible: 3 Standard ‚Üí 1 Urgence M√©dicale</li>
                                <li>üì¶ 3 niveaux de ressources: Standard, Express, Urgence M√©dicale</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Create Mission Tab -->
                    <div id="create" class="tab-pane">
                        <h2>‚ûï Cr√©er une Nouvelle Mission</h2>
                        
                        <form id="createMissionForm" class="form">
                            <div class="form-group">
                                <label for="missionLevel">Niveau de Ressource *</label>
                                <select id="missionLevel" class="form-control" required>
                                    <option value="">-- S√©lectionner un niveau --</option>
                                    <option value="1">Standard (Niveau 1)</option>
                                    <option value="2">Express (Niveau 2)</option>
                                    <option value="3">Urgence M√©dicale (Niveau 3)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="missionName">Nom de la Mission *</label>
                                <input type="text" id="missionName" class="form-control" placeholder="Ex: Mission_Alpha_2026" required>
                            </div>

                            <div class="form-group">
                                <label for="ipfsCID">IPFS CID *</label>
                                <input type="text" id="ipfsCID" class="form-control" placeholder="Ex: QmP7hdxcUCjC5aM6ZgcRvSgMPP9HjL1F9Zr2xVZ1MqQ8Lh" required>
                                <small class="form-text">Hash IPFS contenant les m√©tadonn√©es de la mission</small>
                            </div>

                            <div class="form-group">
                                <label>M√©tadonn√©es IPFS (Optionnel - pour r√©f√©rence)</label>
                                <div class="metadata-fields">
                                    <input type="text" id="metaWeight" class="form-control form-control-sm" placeholder="Poids (ex: 2kg)">
                                    <input type="text" id="metaRange" class="form-control form-control-sm" placeholder="Port√©e (ex: 15km)">
                                    <input type="text" id="metaDeparture" class="form-control form-control-sm" placeholder="D√©part">
                                    <input type="text" id="metaDestination" class="form-control form-control-sm" placeholder="Destination">
                                </div>
                                <small class="form-text">Ces informations sont pour r√©f√©rence. Les vraies m√©tadonn√©es doivent √™tre upload√©es sur IPFS.</small>
                            </div>

                            <button type="submit" class="btn btn-primary btn-large">Cr√©er Mission</button>
                        </form>

                        <div class="ipfs-help">
                            <h4>üí° Comment obtenir un CID IPFS?</h4>
                            <ol>
                                <li>Cr√©ez un fichier JSON avec vos m√©tadonn√©es (voir <code>examples/mission-metadata.json</code>)</li>
                                <li>Uploadez le fichier sur <a href="https://www.pinata.cloud/" target="_blank">Pinata</a> ou un autre service IPFS</li>
                                <li>Copiez le CID g√©n√©r√© et collez-le ci-dessus</li>
                            </ol>
                        </div>
                    </div>

                    <!-- My Missions Tab -->
                    <div id="missions" class="tab-pane">
                        <h2>üóÇÔ∏è Mes Missions</h2>
                        
                        <div class="missions-controls">
                            <button id="refreshMissions" class="btn btn-secondary">üîÑ Actualiser</button>
                            <div class="filter-group">
                                <label>Filtrer par niveau:</label>
                                <select id="filterLevel" class="form-control form-control-sm">
                                    <option value="">Tous</option>
                                    <option value="1">Standard</option>
                                    <option value="2">Express</option>
                                    <option value="3">Urgence M√©dicale</option>
                                </select>
                            </div>
                        </div>

                        <div id="missionsList" class="missions-list">
                            <div class="loading">Chargement des missions...</div>
                        </div>
                    </div>

                    <!-- Swap Resources Tab -->
                    <div id="swap" class="tab-pane">
                        <h2>üîÑ √âchanger des Ressources</h2>
                        
                        <div class="swap-info">
                            <p class="info-message">
                                <strong>R√®gle d'√©change:</strong> Vous pouvez √©changer 3 tokens de niveau Standard contre 1 token de niveau Urgence M√©dicale.
                            </p>
                        </div>

                        <form id="swapForm" class="form">
                            <div class="form-group">
                                <label>S√©lectionner 3 Missions Standard *</label>
                                <div id="standardMissionsList" class="swap-missions-list">
                                    <div class="loading">Chargement des missions Standard...</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="swapIpfsCID">IPFS CID pour la nouvelle mission *</label>
                                <input type="text" id="swapIpfsCID" class="form-control" placeholder="QmP7hdxcUCjC5aM6ZgcRvSgMPP9HjL1F9Zr2xVZ1MqQ8Lh" required>
                            </div>

                            <button type="submit" class="btn btn-primary btn-large">√âchanger 3 ‚Üí 1</button>
                        </form>
                    </div>

                    <!-- Transfer Tab -->
                    <div id="transfer" class="tab-pane">
                        <h2>üì§ Transf√©rer une Mission</h2>
                        
                        <form id="transferForm" class="form">
                            <div class="form-group">
                                <label for="transferTokenId">Mission √† Transf√©rer *</label>
                                <select id="transferTokenId" class="form-control" required>
                                    <option value="">-- S√©lectionner une mission --</option>
                                </select>
                            </div>

                            <div id="transferMissionInfo" class="mission-info-card hidden"></div>

                            <div class="form-group">
                                <label for="transferToAddress">Adresse du Destinataire *</label>
                                <input type="text" id="transferToAddress" class="form-control" placeholder="0x..." required>
                            </div>

                            <button type="submit" class="btn btn-primary btn-large">Transf√©rer Mission</button>
                        </form>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>DroneSecure ¬© 2026 - Syst√®me de Gestion D√©centralis√©e de l'Espace A√©rien</p>
            <p class="footer-links">
                <a href="https://github.com/youvaKA/DroneSecure" target="_blank">GitHub</a> |
                <a href="#" onclick="showDocumentation()">Documentation</a>
            </p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script src="../src/app.js"></script>
</body>
</html>
